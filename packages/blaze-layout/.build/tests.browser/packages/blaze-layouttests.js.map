{"version":3,"file":"\\packages\\blaze-layout:tests.js","sources":["blaze-layout/layout-test.html","blaze-layout/layout-test.js"],"names":[],"mappings":";;;;;;;;;AACA,8C;AACA,kB;AACA,sB;AACA,e;AACA,I;;AAEA,8C;AACA,kB;AACA,sB;AACA,e;AACA,I;;AAEA,mD;AACA,kB;AACA,sB;AACA,kC;AACA,oD;AACA,M;AACA,I;;AAEA,4D;AACA,kB;AACA,sB;AACA,kC;AACA,oD;AACA,yG;AACA,Y;AACA,sC;AACA,M;AACA,0B;AACA,oB;AACA,2D;AACA,Q;AACA,I;;AAEA,uD;AACA,kB;AACA,sB;AACA,yE;AACA,I;;AAEA,wD;AACA,kB;AACA,sB;AACA,qG;AACA,Y;AACA,sC;AACA,M;AACA,0B;AACA,oB;AACA,2D;AACA,Q;AACA,I;;AAEA,kD;AACA,kB;AACA,sB;AACA,iC;AACA,oD;AACA,M;AACA,I;;AAEA,mD;AACA,kB;AACA,sB;AACA,kC;AACA,oD;AACA,M;AACA,I;;AAEA,wC;AACA,kB;AACA,sB;AACA,e;AACA,I;;AAEA,wC;AACA,kB;AACA,sB;AACA,e;AACA,I;;AAEA,sD;AACA,kB;AACA,sB;AACA,+E;AACA,oB;AACA,0B;AACA,M;AACA,I;;AAEA,oD;AACA,kB;AACA,sB;AACA,0D;AACA,Y;AACA,sC;AACA,M;AACA,0B;AACA,oB;AACA,qF;AACA,sB;AACA,gC;AACA,Q;AACA,Q;AACA,I;;;;;;;;;;;;;;;;;;;AC1GA,wC;AACA,2D;AACA,E;;AAEA,qD;AACA,gD;AACA,uC;AACA,c;AACA,E;;AAEA,6C;AACA,gD;AACA,E;;AAEA,uD;AACA,6B;AACA,e;AACA,e;AACA,G;;AAEA,6C;AACA,oC;AACA,iD;;AAEA,O;AACA,qB;AACA,a;AACA,sC;AACA,G;AACA,E;;AAEA,+C;AACA,6B;AACA,e;AACA,e;AACA,G;;AAEA,6C;AACA,oC;AACA,yC;;AAEA,O;AACA,qB;AACA,a;AACA,sC;AACA,G;AACA,E;;AAEA,sE;AACA,yE;AACA,uF;;AAEA,iC;AACA,iB;AACA,wG;AACA,K;AACA,G;;AAEA,uD;AACA,8E;AACA,wB;;AAEA,mC;AACA,oB;AACA,M;;AAEA,wE;AACA,iF;;AAEA,oC;AACA,iB;AACA,0F;;AAEA,wE;AACA,K;AACA,G;;AAEA,qF;AACA,gD;AACA,6B;AACA,iB;AACA,wG;AACA,K;AACA,G;;AAEA,oF;AACA,4E;AACA,yF;AACA,K;AACA,G;;AAEA,gE;AACA,mF;AACA,0B;AACA,uD;;AAEA,2B;AACA,8D;;AAEA,4B;AACA,iB;AACA,iF;AACA,oF;;AAEA,oC;AACA,oC;AACA,iB;AACA,iF;AACA,+F;;AAEA,sC;AACA,iB;AACA,gG;AACA,K;AACA,G;;AAEA,4D;AACA,mF;AACA,wC;AACA,iB;AACA,uG;AACA,K;AACA,G;;AAEA,qE;AACA,8E;AACA,8B;AACA,2D;AACA,qD;;AAEA,gC;AACA,iB;AACA,8F;AACA,oE;;AAEA,gC;AACA,iB;AACA,8F;AACA,oE;AACA,K;AACA,G;;AAEA,kE;AACA,uF;AACA,8B;AACA,2D;;AAEA,6B;AACA,8B;AACA,0E;AACA,4E;;AAEA,8C;AACA,iD;AACA,iB;;AAEA,oC;AACA,qC;AACA,qC;AACA,gE;;AAEA,gC;AACA,iB;;AAEA,oC;AACA,qC;AACA,qC;AACA,mE;;AAEA,gC;AACA,iB;;AAEA,oC;AACA,qC;AACA,qC;AACA,mE;AACA,K;AACA,G;;AAEA,8E;AACA,0C;AACA,iC;;AAEA,O;AACA,e;;AAEA,6B;AACA,6C;AACA,qD;AACA,S;AACA,sE;;AAEA,a;AACA,mC;AACA,G;AACA,G;;AAEA,+E;AACA,0C;AACA,iC;;AAEA,O;AACA,8C;;AAEA,6B;AACA,4C;AACA,sD;AACA,+C;AACA,2C;AACA,sB;;AAEA,a;AACA,mC;AACA,G;AACA,G","sourcesContent":["\nTemplate.__define__(\"LayoutOne\", (function() {\n  var self = this;\n  var template = this;\n  return \"one\";\n}));\n\nTemplate.__define__(\"LayoutTwo\", (function() {\n  var self = this;\n  var template = this;\n  return \"two\";\n}));\n\nTemplate.__define__(\"LayoutWithData\", (function() {\n  var self = this;\n  var template = this;\n  return [ \"layout \", function() {\n    return Spacebars.mustache(self.lookup(\"title\"));\n  } ];\n}));\n\nTemplate.__define__(\"LayoutWithDataAndYields\", (function() {\n  var self = this;\n  var template = this;\n  return [ \"layout \", function() {\n    return Spacebars.mustache(self.lookup(\"title\"));\n  }, \"\\n  \", Spacebars.include(self.lookupTemplate(\"yield\")), \"\\n  \", Spacebars.TemplateWith(function() {\n    return {\n      region: Spacebars.call(\"footer\")\n    };\n  }, UI.block(function() {\n    var self = this;\n    return Spacebars.include(self.lookupTemplate(\"yield\"));\n  })) ];\n}));\n\nTemplate.__define__(\"LayoutWithOneYield\", (function() {\n  var self = this;\n  var template = this;\n  return [ \"layout\\n\", Spacebars.include(self.lookupTemplate(\"yield\")) ];\n}));\n\nTemplate.__define__(\"LayoutWithTwoYields\", (function() {\n  var self = this;\n  var template = this;\n  return [ Spacebars.include(self.lookupTemplate(\"yield\")), \"\\n\", Spacebars.TemplateWith(function() {\n    return {\n      region: Spacebars.call(\"footer\")\n    };\n  }, UI.block(function() {\n    var self = this;\n    return Spacebars.include(self.lookupTemplate(\"yield\"));\n  })) ];\n}));\n\nTemplate.__define__(\"ChildWithData\", (function() {\n  var self = this;\n  var template = this;\n  return [ \"child \", function() {\n    return Spacebars.mustache(self.lookup(\"title\"));\n  } ];\n}));\n\nTemplate.__define__(\"FooterWithData\", (function() {\n  var self = this;\n  var template = this;\n  return [ \"footer \", function() {\n    return Spacebars.mustache(self.lookup(\"title\"));\n  } ];\n}));\n\nTemplate.__define__(\"One\", (function() {\n  var self = this;\n  var template = this;\n  return \"one\";\n}));\n\nTemplate.__define__(\"Two\", (function() {\n  var self = this;\n  var template = this;\n  return \"two\";\n}));\n\nTemplate.__define__(\"DefaultMainRegion\", (function() {\n  var self = this;\n  var template = this;\n  return Spacebars.include(self.lookupTemplate(\"Layout\"), UI.block(function() {\n    var self = this;\n    return \"\\n    ok\\n  \";\n  }));\n}));\n\nTemplate.__define__(\"ContentForTests\", (function() {\n  var self = this;\n  var template = this;\n  return [ \"main\\n  \", Spacebars.TemplateWith(function() {\n    return {\n      region: Spacebars.call(\"footer\")\n    };\n  }, UI.block(function() {\n    var self = this;\n    return Spacebars.include(self.lookupTemplate(\"contentFor\"), UI.block(function() {\n      var self = this;\n      return \"\\n    footer\\n  \";\n    }));\n  })) ];\n}));\n","String.prototype.compact = function () {\n  return this.trim().replace(/\\s/g, '').replace(/\\n/g, '');\n};\n\nvar renderComponent = function (cmp, parent, props) {\n  var inst = UI.render(cmp.extend(props || {}));\n  UI.DomRange.insert(inst.dom, parent);\n  return inst;\n};\n\nvar renderLayout = function (parent, props) {\n  return renderComponent(Layout, parent, props);\n};\n\nvar withRenderedComponent = function (cmp, props, cb) {\n  if (arguments.length < 3) {\n    cb = props;\n    props = {};\n  }\n\n  var screen = document.createElement('div');\n  document.body.appendChild(screen);\n  var inst = renderComponent(cmp, screen, props);\n\n  try {\n    cb(inst, screen);\n  } finally {\n    document.body.removeChild(screen);\n  }\n};\n\nvar withRenderedLayout = function (props, cb) {\n  if (arguments.length < 2) {\n    cb = props;\n    props = {};\n  }\n\n  var screen = document.createElement('div');\n  document.body.appendChild(screen);\n  var inst = renderLayout(screen, props);\n\n  try {\n    cb(inst, screen);\n  } finally {\n    document.body.removeChild(screen);\n  }\n};\n\nTinytest.add('layout - rendering dynamic templates', function (test) {\n  withRenderedLayout({template: 'LayoutOne'}, function (layout, screen) {\n    test.equal(screen.innerHTML.trim(), 'one', 'initial layout template not rendered');\n\n    layout.template('LayoutTwo');\n    Deps.flush();\n    test.equal(screen.innerHTML.trim(), 'two', 'calling template method should change layout template');\n  });\n});\n\nTinytest.add('layout - dynamic data', function (test) {\n  withRenderedLayout({template: 'LayoutWithData'}, function (layout, screen) {\n    var renderCount = 1;\n\n    layout.rendered = function () {\n      renderCount++;\n    };\n\n    test.equal(renderCount, 1, 'layout should have only rendered once');\n    test.equal(screen.innerHTML.trim(), 'layout', 'initial layout not rendered');\n\n    layout.setData({title: 'test'});\n    Deps.flush();\n    test.equal(screen.innerHTML.trim(), 'layout test', 'layout data context not changed');\n\n    test.equal(renderCount, 1, 'layout should have only rendered once');\n  });\n});\n\nTinytest.add('layout - yield into main region with default layout', function (test) {\n  withRenderedLayout(function (layout, screen) {\n    layout.setRegion('One'); \n    Deps.flush();\n    test.equal(screen.innerHTML.trim(), 'one', 'could not render into main region with default layout');\n  });\n});\n\nTinytest.add('layout - default main region using Layout template', function (test) {\n  withRenderedComponent(Template.DefaultMainRegion, function (cmp, screen) {\n    test.equal(screen.innerHTML.trim(), 'ok', 'default main region should be __content');\n  });\n});\n\nTinytest.add('layout - dynamic yield regions', function (test) {\n  withRenderedLayout({template: 'LayoutWithTwoYields'}, function (layout, screen) {\n    var renderedCount = 1;\n    layout.rendered = function () { renderedCount++; };\n\n    var oneRenderCount = 0;\n    Template.One.rendered = function () { oneRenderCount++; };\n\n    layout.setRegion('One');\n    Deps.flush();\n    test.equal(screen.innerHTML.compact(), 'one', 'main region should be \"one\"');\n    test.equal(oneRenderCount, 1, 'template should have been rendered into layout');\n\n    // should be equivalent to above\n    layout.setRegion('main', 'One');\n    Deps.flush();\n    test.equal(screen.innerHTML.compact(), 'one', 'main region should be \"one\"');\n    test.equal(oneRenderCount, 1, 'template already rendered so should not be rendered again');\n\n    layout.setRegion('footer', 'Two');\n    Deps.flush();\n    test.equal(screen.innerHTML.compact(), 'onetwo', 'both yield regions should have rendered');\n  });\n});\n\nTinytest.add('layout - contentFor helper', function (test) {\n  withRenderedLayout({template: 'LayoutWithTwoYields'}, function (layout, screen) {\n    layout.setRegion('ContentForTests');\n    Deps.flush();\n    test.equal(screen.innerHTML.compact(), 'mainfooter', 'contentFor helper should render into yield');\n  });\n});\n\nTinytest.add('layout - global layout data context', function (test) {\n  withRenderedLayout({template: 'LayoutWithData'}, function (layout, screen) {\n    var layoutRenderCount = 1;\n    layout.rendered = function () { layoutRenderCount++; };\n    test.equal(screen.innerHTML.compact(), 'layout');\n\n    layout.setData({title:'1'});\n    Deps.flush();\n    test.equal(screen.innerHTML.compact(), 'layout1', 'data context should be set on layout');\n    test.equal(layoutRenderCount, 1, 'layout should not re-render');\n\n    layout.setData({title:'2'});\n    Deps.flush();\n    test.equal(screen.innerHTML.compact(), 'layout2', 'data context should be set on layout');\n    test.equal(layoutRenderCount, 1, 'layout should not re-render');\n  });\n});\n\nTinytest.add('layout - data with yield regions', function (test) {\n  withRenderedLayout({template: 'LayoutWithDataAndYields'}, function (layout, screen) {\n    var layoutRenderCount = 1;\n    layout.rendered = function () { layoutRenderCount++; };\n\n    var childRenderCount = 0;\n    var footerRenderCount = 0;\n    Template.ChildWithData.rendered = function () { childRenderCount++; };\n    Template.FooterWithData.rendered = function () { footerRenderCount++; };\n\n    layout.setRegion('main', 'ChildWithData');\n    layout.setRegion('footer', 'FooterWithData');\n    Deps.flush();\n\n    test.equal(childRenderCount, 1);\n    test.equal(footerRenderCount, 1);\n    test.equal(layoutRenderCount, 1);\n    test.equal(screen.innerHTML.compact(), 'layoutchildfooter');\n\n    layout.setData({title:'1'});\n    Deps.flush();\n\n    test.equal(childRenderCount, 1);\n    test.equal(footerRenderCount, 1);\n    test.equal(layoutRenderCount, 1);\n    test.equal(screen.innerHTML.compact(), 'layout1child1footer1');\n\n    layout.setData({title:'2'});\n    Deps.flush();\n\n    test.equal(childRenderCount, 1);\n    test.equal(footerRenderCount, 1);\n    test.equal(layoutRenderCount, 1);\n    test.equal(screen.innerHTML.compact(), 'layout2child2footer2');\n  });\n});\n\nTinytest.add('layout - layout template not found in lookup', function (test) {\n  var div = document.createElement('div');\n  document.body.appendChild(div);\n\n  try {\n    var layout;\n\n    test.throws(function () {\n      layout = renderComponent(Layout, div, {\n        template: 'SomeBogusTemplateThatDoesNotExist'\n      });\n    }, /BlazeLayout/); // this checks the error is a BlazeLayout error\n\n  } finally {\n    document.body.removeChild(div);\n  }\n});\n\nTinytest.add('layout - region templates not found in lookup', function (test) {\n  var div = document.createElement('div');\n  document.body.appendChild(div);\n\n  try {\n    var layout = renderComponent(Layout, div);\n\n    test.throws(function () {\n      layout.setRegion('SomeBogusTemplate');\n      // _throwFirstError means it will actually throw\n      // instead of just logging to the console\n      Deps.flush({_throwFirstError: true});\n    }, /BlazeLayout/);\n\n  } finally {\n    document.body.removeChild(div);\n  }\n});\n"]}